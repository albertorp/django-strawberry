{% extends "strawberry/base_strawberry.html" %}

{% load render_table from django_tables2 %}

{% load i18n %}


{% block app %}

<!-- <div x-data="{ recordId: null, recordName: null }"
     x-init="window.openDeleteModal = () => { $dispatch('open-delete-modal') }"> -->
<div>
{% include template_top_title %}

{% if object_list %}
    <div class="my-8">
      {% render_table table %}
    </div>
{% else %}
    <p class="mt-8">{% trans 'There are no' %} {{ object_verbose_name_plural }}. {% trans 'Create one now?' %}</p>
{% endif %}

<hr>

{% if allow_delete %}
{% include template_delete_modal %}

{% endif %}

</div>

{% endblock %}

{% block page_js %}

<script>
// This script implements the "Select All" functionality for the django-tables2 table
document.addEventListener("DOMContentLoaded", function() {
  // find the header checkbox (the one in <th>)
  const headerCheckbox = document.querySelector("th input[type='checkbox']");
  if (!headerCheckbox) return;

  // find all row checkboxes (those in <td>)
  const rowCheckboxes = document.querySelectorAll("td input[type='checkbox']");

  // when header checkbox changes, toggle all row checkboxes
  headerCheckbox.addEventListener("change", function() {
    rowCheckboxes.forEach(cb => cb.checked = headerCheckbox.checked);
  });

  // optional: update header checkbox when all/none are selected
  rowCheckboxes.forEach(cb => {
    cb.addEventListener("change", function() {
      const allChecked = Array.from(rowCheckboxes).every(x => x.checked);
      const noneChecked = Array.from(rowCheckboxes).every(x => !x.checked);
      headerCheckbox.indeterminate = !allChecked && !noneChecked;
      headerCheckbox.checked = allChecked;
    });
  });
});
</script>



<script>
document.addEventListener('DOMContentLoaded', function() {
  const deleteButtons = document.querySelectorAll('.js-delete-btn');
  const recordNameSpan = document.getElementById('delete-record-name');
  const recordIdInput = document.getElementById('delete-record-id-input');
  const deleteForm = document.getElementById('delete-form');

  // Base URL for delete: e.g. "/sampleapp/book/"
  const baseDeleteUrl = "{{ list_view_url }}";  // should end with "/"

  deleteButtons.forEach((btn) => {
    btn.addEventListener('click', function() {
      const recordId = this.dataset.recordId;
      const recordName = this.dataset.recordName;

      if (recordNameSpan) {
        recordNameSpan.textContent = recordName;
      }
      if (recordIdInput) {
        recordIdInput.value = recordId;
      }
      if (deleteForm) {
        deleteForm.action = baseDeleteUrl + recordId + "/delete/";
      }
      // From here, Flowbite handles opening the modal
      // because of data-modal-target / data-modal-toggle on the button.
    });
  });
});
</script>

{% endblock page_js%}
